@model IEnumerable<ToDo.Models.Item>

@{
    ViewBag.Title = "Home Page";
}

<script>
    $(document).ready(function () {
        $("#itemSortable").sortable({
            cancel: ".disable-item-sorting",
            update: function (event, ui) {
                var itemIds = "";
                $("#sortable").find(".parent-card").each(function () {
                    var itemId = $(this).attr("data-item-id");
                    itemIds = itemIds + "," + itemId;
                });
                $.ajax({
                    url: '@Url.Action("Update", "Home")',
                    data: { itemIds: itemIds },
                    type: 'POST',
                    success: function (data) {

                    },
                    error: function (xhr, status, error) {

                    }

                });
            }
        });
       
        $("div[id^='sortable']").sortable({
            update: function (event, ui) {
            },
            stop: function (event, ui) {

            },
            receive: function(event, ui) {
            },
            connectWith: ".sortable"
        });

    });
</script>

<div class="page-header header-filter" data-parallax="true" style="background-image: url('../assets/img/bg7.jpg')">
    <div class="container">
        <div class="card-block" id="itemSortable">
            @foreach (var item in Model)
            {
                <div class="card parent-card" id="item@(item.Id)" data-item-id="@(item.Id)">
                    <div class="card-header card-header-primary parent-card-header">
                        @item.Name
                    </div>
                    <div id="sortable@(item.Id)" class="disable-item-sorting card-body parent-card-body sortable">
                        @{
                            if (item.Children != null)
                            {
                                foreach (var child in item.Children)
                                {
                                    <div class="card sub-card">
                                        <div class="card-body">
                                            @child.Name
                                        </div>
                                    </div>
                                }
                            }
                        }


                    </div>
                    <div class="disable-item-sorting card-footer parent-card-footer">
                        Novo
                    </div>
                </div>
            }
        </div>
    </div>
</div>
